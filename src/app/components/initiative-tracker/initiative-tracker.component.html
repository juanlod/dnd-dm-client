<nz-card class="panel active-card">
  <div class="left">
    <nz-badge [nzCount]="active()?.init" [nzTitle]="'Iniciativa'">
      <nz-avatar
        class="avatar shadow"
        [nzSrc]="active()?.meta?.img || null"
        [nzText]="!active()?.meta?.img ? initials(active()?.name || '') : null">
      </nz-avatar>
    </nz-badge>
    <div class="info">
      <div class="name">{{ active()?.name }}</div>
      <div class="meta">
        <nz-tag nzColor="blue">Turno activo</nz-tag>
        <nz-tag *ngIf="acLabel(active()) as ac">{{ ac }}</nz-tag>
      </div>
    </div>
  </div>

  <div class="right">
    <div class="timer" aria-live="polite">
      <div class="time">{{ timeLeftLabel() }}</div>
      <nz-progress
        [nzPercent]="progress()"
        nzShowInfo="false"
        nzStatus="active"
        [nzStrokeWidth]="10">
      </nz-progress>
    </div>

    <div class="next">
      <span class="lbl">Siguientes</span>
      <div class="chips">
        <span class="chip" *ngFor="let n of nextUp()">{{ n.name }}</span>
        <span class="chip empty" *ngIf="!nextUp().length">—</span>
      </div>
    </div>

    <!-- NUEVO: Botón finalizar turno (solo si es mi turno y el combate corre) -->
    <div class="actions" *ngIf="isMyTurn() && running()">
      <button nz-button nzType="primary" (click)="finishTurn()">Finalizar turno</button>
    </div>
  </div>
</nz-card>
