<div class="auth-wrap glass-bg">
  <div class="glass-card">
    <!-- Cabecera: escudo + título con Uncial Antiqua -->
    <div class="brand">
      <div class="crest">
        <div class="crest-ring"></div>
        <div class="crest-gem">🧙‍♂️</div>
      </div>
      <div class="titles">
        <h1 class="title">Crónicas de la Mesa</h1>
        <p class="subtitle">Comparte el mismo ID de campaña con tu grupo.</p>
      </div>
    </div>

    <div class="divider">
      <span class="orn">✦</span>
      <span class="rule"></span>
      <span class="orn">✦</span>
    </div>

    <!-- Formulario vertical NG-ZORRO -->
    <form nz-form nzLayout="vertical" [formGroup]="form" (ngSubmit)="submit()" class="form">
      <!-- Nombre -->
      <nz-form-item>
        <nz-form-label [nzRequired]="true" nzFor="name">Tu nombre</nz-form-label>
        <nz-form-control [nzValidateStatus]="f.name" [nzErrorTip]="nameErrors">
          <nz-input-group [nzPrefix]="namePrefix">
            <input
              nz-input
              id="name"
              formControlName="name"
              placeholder="Ej: Lirien"
              autocomplete="off"
            />
          </nz-input-group>
          <ng-template #namePrefix>👤</ng-template>
          <ng-template #nameErrors>
            <ng-container *ngIf="f.name.hasError('required')">El nombre es obligatorio.</ng-container>
            <ng-container *ngIf="f.name.hasError('minlength')">Mínimo 2 caracteres.</ng-container>
            <ng-container *ngIf="f.name.hasError('maxlength')">Máximo 24 caracteres.</ng-container>
            <ng-container *ngIf="f.name.hasError('pattern')">Usa letras/números/espacios/guiones.</ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <!-- ID de campaña -->
      <nz-form-item>
        <nz-form-label [nzRequired]="true" nzFor="roomId">ID de campaña</nz-form-label>
        <nz-form-control [nzValidateStatus]="f.roomId" [nzErrorTip]="roomErrors">
          <nz-input-group [nzPrefix]="roomPrefix" [nzSuffix]="roomSuffix">
            <input
              nz-input
              id="roomId"
              formControlName="roomId"
              placeholder="ej: bosque-37"
              autocomplete="off"
            />
          </nz-input-group>
          <ng-template #roomPrefix>🏷️</ng-template>
          <ng-template #roomSuffix>
            <button nz-button nzSize="small" type="button" class="btn-ghost" (click)="generateRoomId()">Generar</button>
          </ng-template>
          <ng-template #roomErrors>
            <ng-container *ngIf="f.roomId.hasError('required')">El ID es obligatorio.</ng-container>
            <ng-container *ngIf="f.roomId.hasError('minlength')">Mínimo 3 caracteres.</ng-container>
            <ng-container *ngIf="f.roomId.hasError('maxlength')">Máximo 40 caracteres.</ng-container>
            <ng-container *ngIf="f.roomId.hasError('pattern')">Solo minúsculas, números y guiones (slug).</ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <div class="remember">
        <label nz-checkbox formControlName="remember">Recordarme en este equipo</label>
      </div>

      <div class="actions">
        <button
          nz-button
          nzType="primary"
          class="btn-primary-glow"
          [nzLoading]="loading"
          [disabled]="form.invalid || loading"
          htmlType="submit">
          <span class="btn-ico">🗝️</span> Entrar
        </button>

        <button
          nz-button
          type="button"
          class="btn-ghost"
          (click)="form.reset({ name: '', roomId: '', remember: true })">
          Limpiar
        </button>
      </div>

      <div class="general-error" *ngIf="generalError">{{ generalError }}</div>
      <div class="footer-hint">Usa el mismo ID de campaña que tu grupo para entrar en la misma mesa.</div>
    </form>
  </div>
</div>
